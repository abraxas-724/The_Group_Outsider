<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="css/style0.css?v=14">
    <link rel="stylesheet" href="css/save-load-panel.css?v=14">
    <link rel="stylesheet" href="css/game-inline.css?v=14">
    <title>《组外人》</title>
</head>

<body>

    <!-- 顶部绝对定位按钮已移除，改为放在对话框下方 -->

    <div id="game-container">
        <img id="scene-background" src="" alt="Game Scene">
        <div id="character-layer">
        </div>
        <div id="ui-layer">
            <div id="dialogue-box" class="hidden">
                <div class="dialogue-content">
                    <p id="speaker-name"></p>
                    <p id="dialogue-text"></p>
                </div>
                <!-- 新增：存/读档按钮条放在对话内容下方 -->
                <div id="dialogue-save-load-bar">
                    <div class="sl-toggle-wrap">
                        <button id="sl-toggle" class="dlg-sl-btn"><span class="label">S&L</span><span class="arrow"
                                aria-hidden="true">▼</span></button>
                        <div id="sl-mini" class="sl-mini hidden" aria-hidden="true">
                            <button id="save-menu-button" class="dlg-sl-btn mini">保存</button>
                            <button id="load-menu-button" class="dlg-sl-btn mini">读取</button>
                        </div>
                    </div>
                    <button id="quick-save" class="dlg-sl-btn" title="快捷键: S">快速存档 (S)</button>
                    <button id="quick-load" class="dlg-sl-btn" title="快捷键: L">快速读档 (L)</button>
                    <button id="open-achievements" class="dlg-sl-btn" title="快捷键: J">行为记录 (J)</button>
                    <button id="open-settings" class="dlg-sl-btn">设置</button>
                </div>
            </div>

            <!-- 内嵌存/读档面板 -->
            <div id="inline-save-load" class="sl-hidden" aria-hidden="true">
                <div class="sl-panel" role="dialog" aria-modal="true" aria-labelledby="sl-title">
                    <div class="sl-header">
                        <h2 id="sl-title">存档</h2>
                        <div class="sl-header-actions">
                            <button id="sl-refresh" class="sl-btn sl-ghost" title="刷新">刷新</button>
                            <button id="sl-close" class="sl-btn sl-ghost" title="关闭 (Esc)">✕</button>
                        </div>
                    </div>
                    <div class="sl-hint" id="sl-hint">单击槽位：执行当前操作。双击：快速执行。保存会覆盖原数据。</div>
                    <div class="sl-slots" id="sl-slots"></div>
                    <div class="sl-footer">本地存档 (最多 6 个槽位)</div>
                </div>
            </div>

            <!-- 内嵌设置面板 (扩展版) -->
            <div id="settings-overlay" class="sl-hidden" aria-hidden="true">
                <div class="sl-panel"
                    style="width:clamp(640px,78vw,1180px);max-height:84vh;padding:26px 28px 30px;gap:20px;"
                    role="dialog" aria-modal="true" aria-labelledby="settings-title-inline">
                    <div class="sl-header" style="margin-bottom:4px;">
                        <h2 id="settings-title-inline" style="font-size:1.05rem;letter-spacing:.25em;">设置 SETTINGS</h2>
                        <div class="sl-header-actions">
                            <button id="st-close" class="sl-btn sl-ghost" title="关闭">✕</button>
                        </div>
                    </div>
                    <div class="sl-hint" style="margin-top:-4px;">即时生效 · 关闭或按 ESC 返回游戏 · 存档包含当时设置快照</div>
                    <div class="settings-grid-inline three-cols" style="overflow:auto;">
                        <div class="setting-card-inline"
                            style="display:flex;flex-direction:column;gap:10px;padding:14px 16px 16px;background:#1f262d;border:1px solid #2b3643;border-radius:14px;">
                            <h3 style="margin:0;font-size:.78rem;letter-spacing:.12em;font-weight:600;color:#e2e8f0;">文本
                                & 自动</h3>
                            <label style="font-size:.6rem;display:flex;flex-direction:column;gap:4px;">文本速度 <input
                                    id="st-text-speed" type="range" min="10" max="120" value="35"></label>
                            <div style="font-size:.55rem;">当前: <span id="st-text-speed-val">35</span> ms/字符</div>
                            <label style="font-size:.6rem;display:flex;align-items:center;gap:6px;"> <input
                                    id="st-skip-read" type="checkbox"> 已读瞬显</label>
                            <label style="font-size:.6rem;display:flex;align-items:center;gap:6px;"> <input
                                    id="st-auto-mode" type="checkbox"> 自动播放</label>
                            <label style="font-size:.6rem;display:flex;flex-direction:column;gap:4px;">自动间隔 <input
                                    id="st-auto-interval" type="range" min="800" max="4000" step="100"
                                    value="1800"></label>
                            <div style="font-size:.55rem;">间隔: <span id="st-auto-interval-val">1800</span> ms</div>
                            <label style="font-size:.6rem;display:flex;flex-direction:column;gap:4px;">对话框透明度 <input
                                    id="st-dlg-opacity" type="range" min="0.4" max="1" step="0.05" value="0.8"></label>
                            <div style="font-size:.55rem;">透明度: <span id="st-dlg-opacity-val">0.8</span></div>
                        </div>
                        <div class="setting-card-inline"
                            style="display:flex;flex-direction:column;gap:10px;padding:14px 16px 16px;background:#1f262d;border:1px solid #2b3643;border-radius:14px;">
                            <h3 style="margin:0;font-size:.78rem;letter-spacing:.12em;font-weight:600;color:#e2e8f0;">音量
                                Volume</h3>
                            <label style="font-size:.6rem;display:flex;flex-direction:column;gap:4px;">主音量 <input
                                    id="st-vol-master" type="range" min="0" max="100" value="80"></label>
                            <label style="font-size:.6rem;display:flex;flex-direction:column;gap:4px;">环境音 <input
                                    id="st-vol-amb" type="range" min="0" max="100" value="60"></label>
                            <button id="st-audio-mute" class="sl-btn sl-ghost"
                                style="font-size:.6rem;align-self:flex-start;">快速静音</button>
                        </div>
                        <!-- 主题设置已按需求移除 -->
                        <div class="setting-card-inline"
                            style="display:flex;flex-direction:column;gap:10px;padding:14px 16px 16px;background:#1f262d;border:1px solid #2b3643;border-radius:14px;">
                            <h3 style="margin:0;font-size:.78rem;letter-spacing:.12em;font-weight:600;color:#e2e8f0;">数据
                                Data</h3>
                            <button id="st-reset-default" class="sl-btn sl-ghost"
                                style="font-size:.6rem;">恢复默认设置</button>
                            <button id="st-clear-read" class="sl-btn sl-ghost" style="font-size:.6rem;">清除已读标记</button>
                            <button id="st-clear-all" class="sl-btn delete" style="font-size:.6rem;">清除全部数据</button>
                            <p style="margin:4px 0 0;font-size:.55rem;line-height:1.3;color:#94a3b8;">清除包含账号、存档、已读标记与设置。
                            </p>
                        </div>
                    </div>
                    <div class="sl-footer"
                        style="text-align:left;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-top:2px;">
                        <span style="font-size:.55rem;opacity:.75;">THE GROUP OUTSIDER · INLINE SETTINGS
                            (EXPANDED)</span>
                        <div style="display:flex;gap:8px;flex-wrap:wrap;">
                            <button id="st-return" class="sl-btn sl-return">返回首页</button>
                            <button id="st-close-2" class="sl-btn sl-ghost">关闭</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="centered-choices" class="hidden">
            </div>
            <div id="minigame-overlay"></div>
        </div>


    </div>

    <script type="module" src="js/main.js?v=14"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(() => { });
            });
        }
    </script>
    <script src="js/game-inline-init.js?v=14"></script>
    <!-- Toast styles moved to css/game-inline.css -->
</body>

</html>
