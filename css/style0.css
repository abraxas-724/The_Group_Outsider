/* å“åº”å¼ä¸å®‰å…¨åŒºå˜é‡?*/
:root {
    --safe-top: env(safe-area-inset-top);
    --safe-right: env(safe-area-inset-right);
    --safe-bottom: env(safe-area-inset-bottom);
    --safe-left: env(safe-area-inset-left);
}

/* --- åŸºç¡€ä¸å…¨å±€å¸ƒå±€ (Base & Global Layout) --- */
body {
    background-color: #000;
    color: #E5E7EB;
    font-family: "PingFang SC", "Microsoft YaHei", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    overflow: hidden;
}

/* ä¿®æ­£ç§»åŠ¨ç«¯åœ°å€æ å¯¼è‡´çš„ 100vh åå·®ï¼ˆæ”¯æŒåŠ¨æ€è§†å£å•ä½æ—¶ï¼?*/
@supports (height: 100dvh) {
    body {
        height: 100dvh;
    }
}

#game-container {
    position: relative;
    /* ä»?16:9 ä¸ºè®¾è®¡åŸºå‡†ï¼Œåœ¨è§†å£å†…ç­‰æ¯”ç¼©æ”¾ï¼Œä¸æº¢å‡º */
    width: min(100vw, calc(100vh * (16 / 9)));
    height: min(100vh, calc(100vw * (9 / 16)));
    max-width: 100vw;
    max-height: 100vh;
    aspect-ratio: 16 / 9;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    background-color: #111;
    overflow: hidden;
    /* ä¸ºå¸¦åˆ˜æµ·è®¾å¤‡é¢„ç•™å®‰å…¨è¾¹è· */
    padding: max(0px, var(--safe-top)) max(0px, var(--safe-right)) max(0px, var(--safe-bottom)) max(0px, var(--safe-left));
}

/* ä½¿ç”¨åŠ¨æ€è§†å£å•ä½ï¼Œåœ¨æ”¯æŒçš„æµè§ˆå™¨ä¸Šé¿å…åœ°å€æ å¯¼è‡´çš„ 100vh åå·® */
@supports (height: 100dvh) {
    #game-container {
        width: min(100dvw, calc(100dvh * (16 / 9)));
        height: min(100dvh, calc(100dvw * (9 / 16)));
        max-width: 100dvw;
        max-height: 100dvh;
    }
}

/* --- æ¸¸æˆå›¾å±‚ (Game Layers) --- */
#scene-background,
#character-layer,
#ui-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

#scene-background {
    object-fit: cover;
    transition: opacity 0.8s ease-in-out;
    z-index: 1;
}

#character-layer {
    z-index: 2;
}

#ui-layer {
    z-index: 3;
    pointer-events: auto;
}

/* --- è§’è‰²æ ·å¼ (Character Styles) --- */
.character {
    position: absolute;
    height: clamp(46%, 58vw, 60%);
    bottom: 0;
    transform: translateX(-50%);
    transition: all 0.4s ease-in-out, filter 0.3s ease-in-out;
}

.pos-left {
    left: 25%;
}

.pos-center {
    left: 50%;
}

.pos-right {
    left: 80%;
}

.hidden {
    opacity: 0;
    transform: translateX(-50%) translateY(50px);
}

.inactive {
    filter: brightness(0.6);
}

/* --- UI - å¯¹è¯æ¡?(UI - Dialogue Box) --- */
#dialogue-box {
    position: absolute;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    width: min(94%, 1400px);
    height: 25%;
    padding: clamp(14px, 2.2vh, 30px) clamp(14px, 2.2vh, 30px) clamp(60px, 8vh, 90px);
    box-sizing: border-box;
    background-color: rgba(17, 24, 39, 0.85);
    border: 2px solid #4B5563;
    border-radius: 10px;
    color: #E5E7EB;
    font-family: "PingFang SC", Arial, sans-serif;
    opacity: 1;
    transition: opacity 0.3s ease;
    pointer-events: auto;
    cursor: pointer;
}

/* ç¾åŒ–æ»šåŠ¨æ?*/
.dialogue-content::-webkit-scrollbar {
    width: 6px;
}

.dialogue-content::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
}

.dialogue-content::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
}

.dialogue-content::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5);
}

#dialogue-box.hidden {
    opacity: 0;
    pointer-events: none;
}

/* é˜²æ­¢å¿«é€Ÿç‚¹å‡»æ—¶é€‰ä¸­æ–‡æœ¬/å‡ºç°ç³»ç»Ÿå‘¼å‡ºä¸ç‚¹å‡»é«˜äº?â€”â€?æ‰©å¤§åˆ°æ•´é¡µï¼ˆä»?game.html å¼•å…¥æœ¬æ–‡ä»¶ï¼‰ */
body,
body * {
    -webkit-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: transparent;
}

/* ä»å…è®¸åœ¨è¡¨å•/å¯ç¼–è¾‘åŒºåŸŸé€‰æ‹©æ–‡æœ¬ */
input,
textarea,
[contenteditable="true"],
input *,
textarea *,
[contenteditable="true"] * {
    -webkit-user-select: text;
    -ms-user-select: text;
    user-select: text;
    -webkit-touch-callout: default;
}

/* å¦‚éœ€åœ¨æŸå¤„å…è®¸é€‰ä¸­æ–‡æœ¬ï¼Œå¯ä¸ºå®¹å™¨æ·»åŠ?.allow-select */
.allow-select,
.allow-select * {
    -webkit-user-select: text !important;
    -ms-user-select: text !important;
    user-select: text !important;
    -webkit-touch-callout: default !important;
}

#speaker-name {
    font-family: "PingFang SC", Arial, sans-serif;
    font-weight: 700;
    font-size: clamp(1rem, 2vw + 0.8rem, 2.2rem);
    color: #2563eb;
    margin: 0 0 0.6em 0;
}

#dialogue-text {
    font-family: "PingFang SC", Arial, sans-serif;
    margin: 0;
    font-size: clamp(0.95rem, 2.2vw + 0.5rem, 1.6rem);
    line-height: 1.65;
    color: #E5E7EB;
}

/* ç§»åŠ¨ç«¯é€šç”¨ä¼˜åŒ–ï¼šç¼©å°å¯¹è¯æ¡†å¹¶ç¡®ä¿å†…å®¹ä¸æº¢å‡º */
@media (max-width: 768px) {
@media (max-width: 768px) {
    #dialogue-box {
        width: min(96%, 1200px);
        height: clamp(80px, 12vh, 120px);
        min-height: clamp(70px, 10vh, 100px);
        max-height: clamp(150px, 28vh, 250px);
        padding: clamp(12px, 2vh, 24px) clamp(12px, 2vh, 24px) clamp(55px, 7vh, 80px);
        bottom: 20px;
        border-width: 1px;
    }
    }

    #speaker-name {
        font-size: clamp(0.9rem, 1.8vw + 0.6rem, 1.8rem);
        margin-bottom: 0.4em;
    }

    #dialogue-text {
        font-size: clamp(0.85rem, 2vw + 0.4rem, 1.3rem);
        line-height: 1.55;
    }
}

/* å°å±æ‰‹æœºè¿›ä¸€æ­¥ä¼˜åŒ?*/
@media (max-width: 480px) {
    #dialogue-box {
        width: min(98%, 1000px);
        min-height: clamp(60px, 8vh, 90px);
        max-height: clamp(140px, 24vh, 200px);
        padding: 10px 10px clamp(50px, 6vh, 70px);
        bottom: 15px;
    }

    #speaker-name {
        font-size: clamp(0.85rem, 1.5vw + 0.5rem, 1.5rem);
    }

    #dialogue-text {
        font-size: clamp(0.8rem, 1.8vw + 0.3rem, 1.2rem);
        line-height: 1.5;
    }
}

/* æ¨ªå±ä¸”é«˜åº¦è¾ƒå°çš„è®¾å¤‡ï¼šæ•´ä½?UI ç¼©æ”¾ä»¥é¿å…è¿‡å¤?*/
@media (orientation: landscape) and (max-height: 480px) {
    #dialogue-box {
        height: clamp(16%, 20vh, 22%);
        padding: 10px 12px clamp(38px, 6vh, 60px);
        border-width: 1px;
    }

    #speaker-name {
        font-size: clamp(0.95rem, 1.2rem, 1.4rem);
    }

    #dialogue-text {
        font-size: clamp(0.9rem, 1.05rem, 1.2rem);
        line-height: 1.5;
    }
}

/* æ¨ªå±æ¨¡å¼é€šç”¨ä¼˜åŒ–ï¼šç¡®ä¿å¯¹è¯æ¡†ä¸ä¼šè¿‡é«˜ */
@media (orientation: landscape) and (max-height: 600px) {
    #dialogue-box {
        min-height: clamp(60px, 10vh, 80px);
        max-height: clamp(120px, 22vh, 160px);
        padding: 8px 14px clamp(45px, 7vh, 65px);
        bottom: 15px;
        width: min(94%, 1300px);
    }

    #speaker-name {
        font-size: clamp(0.9rem, 1.4rem, 1.6rem);
        margin-bottom: 0.3em;
    }

    #dialogue-text {
        font-size: clamp(0.85rem, 1.1rem, 1.3rem);
        line-height: 1.45;
    }
}

/* æ¨ªå±ä¸”æçŸ®å±ï¼šæœ€æ¿€è¿›å‹ç¼?*/
@media (orientation: landscape) and (max-height: 400px) {
    #dialogue-box {
        min-height: clamp(40px, 6vh, 60px);
        max-height: clamp(80px, 14vh, 100px);
        padding: 6px 10px clamp(35px, 5vh, 50px);
        bottom: 10px;
    }

    #speaker-name {
        font-size: clamp(0.8rem, 1rem, 1.2rem);
        margin-bottom: 0.2em;
    }

    #dialogue-text {
        font-size: clamp(0.75rem, 0.9rem, 1rem);
        line-height: 1.3;
    }
}

#choices-container {
    position: relative;
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

#centered-choices {
    position: fixed;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 4vh 6vw;
    gap: 38px;
    background: rgba(17, 24, 39, 0.60);
    backdrop-filter: blur(8px) saturate(140%);
    -webkit-backdrop-filter: blur(8px) saturate(140%);
    z-index: 220;
    opacity: 1;
    transition: opacity .3s ease;
}

#centered-choices.hidden {
    opacity: 0;
    pointer-events: none;
}

.choice-button {
    width: min(880px, 92vw);
    padding: 18px 28px;
    background: linear-gradient(145deg, #1f2937, #111827);
    border: 2px solid #4B5563;
    border-radius: 14px;
    color: #e5e7eb;
    text-align: center;
    font-size: 1.2em;
    line-height: 1.45;
    font-family: "PingFang SC", Arial, sans-serif;
    font-weight: 400;
    letter-spacing: .5px;
    cursor: pointer;
    transition: background .25s, border-color .25s, transform .18s, color .25s, box-shadow .3s;
    position: relative;
}

.choice-button:hover,
.choice-button:focus {
    background: linear-gradient(145deg, #2563eb, #9333ea);
    border-color: #2563eb;
    color: #fff;
    transform: translateY(-3px);
    box-shadow: 0 10px 28px -10px rgba(59, 130, 246, .55), 0 0 0 1px rgba(255, 255, 255, .06) inset;
    outline: none;
}

.choice-button:active {
    transform: translateY(-1px) scale(.985);
}

.choice-button.choice-faded {
    opacity: .35;
    filter: grayscale(.4) brightness(.8);
}

@media (max-width:680px) {
    .choice-button {
        font-size: 1.05rem;
        padding: 14px 18px;
        border-radius: 11px;
    }

    #centered-choices {
        gap: 26px;
        padding: 4vh 4vw;
    }
}

/* æ¨ªå±ä¸”é«˜åº¦è¾ƒå°æ—¶ï¼Œå‹ç¼©é€‰é¡¹æŒ‰é’®ä¸é—´è·ï¼Œé¿å…é®æŒ¡ */
@media (orientation: landscape) and (max-height: 480px) {
    #centered-choices {
        gap: 18px;
        padding: 3vh 3vw;
    }

    .choice-button {
        font-size: 0.95rem;
        padding: 10px 14px;
        border-width: 1px;
        border-radius: 10px;
    }
}

/* é€‰ä¸­æˆ–ç¦ç”¨æ—¶çš„æ ·å¼ï¼Œé˜²æ­¢å†æ¬¡è§¦å‘ */
.choice-button:disabled {
    opacity: 0.55;
    cursor: default;
    background-color: #303841;
}

.choice-faded {
    opacity: 0.35;
}

/* ===== ç§»åŠ¨ç«¯ä¸“ç”¨æ ·å¼?(Mobile Only Styles) ===== */
/* ç§»åŠ¨ç«¯å¯¹è¯æ¡†ï¼šä½¿ç”¨flexå¸ƒå±€å®ç°è‡ªåŠ¨é«˜åº¦å’Œæ»šåŠ?*/
@media (max-width: 768px) {
    #dialogue-box {
        /* ç§»åŠ¨ç«¯æ”¹ä¸ºflexå¸ƒå±€ */
        display: flex;
        flex-direction: column;
        /* è‡ªé€‚åº”é«˜åº¦ */
        min-height: 25%;
        max-height: clamp(180px, 32vh, 320px);
        height: auto;
        /* è°ƒæ•´ç§»åŠ¨ç«¯å†…è¾¹è· */
        padding: clamp(10px, 2vh, 20px) clamp(10px, 2vh, 20px) clamp(8px, 1.5vh, 12px);
    }

    /* ç§»åŠ¨ç«¯å¯¹è¯å†…å®¹ï¼šå¯æ»šåŠ¨åŒºåŸ?*/
    .dialogue-content {
        flex: 1;
        overflow-y: auto;
        min-height: 0;
        padding-right: 4px;
    }

    /* ç§»åŠ¨ç«¯æ»šåŠ¨æ¡æ ·å¼ */
    .dialogue-content::-webkit-scrollbar {
        width: 4px;
    }

    .dialogue-content::-webkit-scrollbar-track {
        background: transparent;
    }

    .dialogue-content::-webkit-scrollbar-thumb {
        background: rgba(156, 163, 175, 0.5);
        border-radius: 20px;
    }

    .dialogue-content::-webkit-scrollbar-thumb:hover {
        background: rgba(156, 163, 175, 0.7);
    }

    /* ç§»åŠ¨ç«¯æ–‡å­—å¤§å°è°ƒæ•?*/
    #speaker-name {
        font-size: clamp(13px, 3.2vw, 16px);
    }

    #dialogue-text {
        font-size: clamp(12px, 3vw, 15px);
        line-height: 1.4;
    }
}

/* æ¨ªå±æ¨¡å¼ç‰¹æ®Šå¤„ç†ï¼šå¢åŠ é«˜åº¦ä»¥å®¹çº³æ–‡å­— */
@media (orientation: landscape) and (max-height: 600px) {
    #dialogue-box {
        /* æ¨ªå±æ—¶æ”¹ä¸ºflexå¸ƒå±€ */
        display: flex;
        flex-direction: column;
        /* æ¨ªå±æ—¶å¢åŠ æœ€å°é«˜åº¦ï¼Œç¡®ä¿æ–‡å­—å¯è§ */
        min-height: clamp(100px, 20vh, 140px);
        max-height: clamp(200px, 50vh, 280px);
        height: auto;
        /* æ¨ªå±æ—¶å‡å°‘åº•éƒ¨paddingï¼Œä¸ºæŒ‰é’®ç•™å‡ºç©ºé—´ */
        padding: clamp(8px, 1.5vh, 15px) clamp(10px, 2vh, 20px) clamp(6px, 1vh, 10px);
    }

    /* æ¨ªå±æ¨¡å¼ä¸‹å¯¹è¯å†…å®¹åŒºåŸ?*/
    .dialogue-content {
        flex: 1;
        overflow-y: auto;
        min-height: 0;
        padding-right: 4px;
        /* ç¡®ä¿å†…å®¹åŒºåŸŸæœ‰è¶³å¤Ÿçš„æœ€å°é«˜åº?*/
        min-height: 60px;
    }

    /* æ¨ªå±æ¨¡å¼ä¸‹æ–‡å­—ç¨å¾®ç¼©å°?*/
    #speaker-name {
        font-size: clamp(11px, 2.8vw, 14px);
    }

    #dialogue-text {
        font-size: clamp(10px, 2.5vw, 13px);
        line-height: 1.3;
    }
}

/* å°å±å¹•ç§»åŠ¨è®¾å¤‡è¿›ä¸€æ­¥ä¼˜åŒ?*/
@media (max-width: 480px) {
    #dialogue-box {
        width: 96%;
        padding: 8px 8px 6px;
    }

    #speaker-name {
        font-size: clamp(12px, 3.5vw, 14px);
    }

    #dialogue-text {
        font-size: clamp(11px, 3.2vw, 13px);
    }
}
